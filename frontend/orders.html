<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Your Orders | Grocery Delivery</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body { background: #f5f7fa; }

    .navbar-brand {
        font-weight: 700;
        font-size: 1.4rem;
    }

    /* Order Card */
    .order-card {
        background: #ffffff;
        border-radius: 14px;
        padding: 0;
        margin-bottom: 18px;
        box-shadow: 0 3px 12px rgba(0,0,0,0.07);
    }

    .order-header {
        background: #0d6efd;
        color: white;
        padding: 14px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 14px 14px 0 0;
    }

    .order-body {
        padding: 16px;
        font-size: 0.95rem;
    }

    .order-body p {
        margin: 4px 0;
    }

    .item-list {
        padding-left: 20px;
        margin-top: 10px;
    }

    .badge-status {
        background: #6c757d;
        font-size: 0.85rem;
        padding: 6px 10px;
        border-radius: 6px;
    }

    .status-completed { background: #28a745 !important; }
    .status-pending { background: #ffc107 !important; color: black !important; }
    .status-cancelled { background: #dc3545 !important; }
</style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-3">
    <a class="navbar-brand" href="home.html">Grocery Delivery</a>

    <div class="ms-auto">
        <button class="btn btn-outline-primary me-2" onclick="location.href='cart.html'">Cart ðŸ›’</button>
        <button class="btn btn-outline-danger" onclick="logout()">Logout</button>
    </div>
</nav>

<div class="container mt-4">
    <h3 class="fw-bold mb-3">Your Orders</h3>
    <div id="ordersContainer" class="mt-3"></div>
</div>

<script>
const access = localStorage.getItem("access");
if (!access) {
    alert("Please login first!");
    window.location.href = "login.html";
}

/* Load Orders */
async function loadOrders() {
    const container = document.getElementById("ordersContainer");
    container.innerHTML = "<p>Loading your orders...</p>";

    try {
        const res = await fetch("http://127.0.0.1:8000/api/orders/", {
            headers: { "Authorization": "Bearer " + access }
        });

        const data = await res.json();
        container.innerHTML = "";

        if (data.length === 0) {
            container.innerHTML = `<p>You have no orders yet.</p>`;
            return;
        }

        data.forEach(order => {
            let itemsHtml = "";
            order.items.forEach(item => {
                itemsHtml += `
                    <li>${item.product.name} Ã— ${item.quantity} (${item.product.unit_name}) â€” â‚¹${item.price_at_order}</li>
                `;
            });

            // Status color classes
            let statusClass = "badge-status";
            if (order.status.toLowerCase() === "completed") statusClass += " status-completed";
            if (order.status.toLowerCase() === "pending") statusClass += " status-pending";
            if (order.status.toLowerCase() === "cancelled") statusClass += " status-cancelled";

            container.innerHTML += `
                <div class="order-card">
                    <div class="order-header d-flex justify-content-between">
                        <span>Order #${order.id}</span>
                        <span class="badge ${statusClass}">${order.status}</span>
                    </div>

                    <div class="order-body">
                        <p><strong>Name:</strong> ${order.first_name} ${order.last_name}</p>
                        <p><strong>Phone:</strong> ${order.phone}</p>
                        <p><strong>Address:</strong> ${order.address}</p>
                        <p><strong>Delivery Slot:</strong> ${order.slot}</p>
                        <p><strong>Total Price:</strong> â‚¹${order.total_price}</p>

                        <p class="mt-2"><strong>Items:</strong></p>
                        <ul class="item-list">${itemsHtml}</ul>
                    </div>
                </div>
            `;
        });

    } catch (err) {
        console.error(err);
        container.innerHTML = "<p class='text-danger'>Failed to load orders.</p>";
    }
}

/* Logout */
function logout() {
    localStorage.clear();
    window.location.href = "login.html";
}

document.addEventListener("DOMContentLoaded", loadOrders);
</script>

</body>
</html>
